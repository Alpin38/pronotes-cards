alias: Nouvelle Note XXX
description: Notification sur nouvelle note
trigger:
  - platform: state
    entity_id: sensor.pronote_XXXXXXX_evaluations
    id: note_enfant1
    to: null
condition: []
action:
  - if:
      - condition: trigger
        id: note_enfant1
    then:
      - service: notify.persistent_notification
        data:
          message: |
            {% set evals = state_attr('sensor.pronote_XXXXXXXXX_evaluations','evaluations')[0] %}
            {% set acquisitions = evals.acquisitions %}
            XXXXX, viens de recevoir {{acquisitions|count}} √©valuation{% if acquisitions|count >1 %}s{%endif%} en {{evals.subject}}{% if acquisitions|count >1 %}
            {% for j in range(0,acquisitions|count,1) %}{% if acquisitions[j].level == 'Tr√®s bonne ma√Ætrise' %}üîµ-> Th√®me: {{evals.acquisitions[j].name}}
            {% elif acquisitions[j].level == 'Ma√Ætrise satisfaisante' %}üü¢-> Th√®me: {{evals.acquisitions[j].name}}
            {% elif acquisitions[j].level == "D√©but de ma√Ætrise" %}üü°-> Th√®me: {{evals.acquisitions[j].name}}
            {% elif acquisitions[j].level == 'Ma√Ætrise fragile'  %}üü°-> Th√®me: {{evals.acquisitions[j].name}}
            {% elif acquisitions[j].level == 'Ma√Ætrise insuffisante'  %}üî¥-> Th√®me: {{evals.acquisitions[j].name}}
            {% else %}?-> Th√®me: {{evals.acquisitions[j].name}}
            {% endif %}{% endfor %}   
            {% else %}
            {% if acquisitions[1].level == 'Tr√®s bonne ma√Ætrise' %}üîµ-> Th√®me: {{evals.acquisitions[j].name}}
            {% elif acquisitions[1].level == 'Ma√Ætrise satisfaisante' %}üü¢-> Th√®me: {{evals.acquisitions[j].name}}
            {% elif acquisitions[1].level == "D√©but de ma√Ætrise" %}üü°-> Th√®me: {{evals.acquisitions[j].name}}
            {% elif acquisitions[1].level == 'Ma√Ætrise fragile'  %}üü°-> Th√®me: {{evals.acquisitions[j].name}}
            {% elif acquisitions[1].level == 'Ma√Ætrise insuffisante'  %}üî¥-> Th√®me: {{evals.acquisitions[j].name}}
            {% else %}?-> Th√®me: {{evals.acquisitions[j].name}}
            {% endif %}{% endif %}
mode: single
