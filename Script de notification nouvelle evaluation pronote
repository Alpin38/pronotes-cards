alias: Nouvelle Note XXX
description: Notification sur nouvelle note
trigger:
  - platform: state
    entity_id: sensor.pronote_XXXXXXX_evaluations
    id: note_enfant1
    to: null
condition: []
action:
  - if:
      - condition: trigger
        id: note_enfant1
    then:
      - service: notify.persistent_notification
        data:
          message: >
            {% set evals =
            state_attr('sensor.pronote_XXXXXX_evaluations','evaluations')[0]
            %}

            {% set acquisitions = evals.acquisitions %}

            ZoÃ©, viens de recevoir {{acquisitions|count}} Ã©valuation{% if
            acquisitions|count >1 %}s{%endif%} en {{evals.subject}}{% if
            acquisitions|count >1 %}

            {% for j in range(0,acquisitions|count,1) %}{% if
            acquisitions[j].level == 'TrÃ¨s bonne maÃ®trise' %}ðŸ”µ-> 
            {{evals.acquisitions[j].name}}

            {% elif acquisitions[j].level == 'MaÃ®trise satisfaisante' %}ðŸŸ¢->
            {{evals.acquisitions[j].name}}

            {% elif acquisitions[j].level == "DÃ©but de maÃ®trise" %}ðŸŸ¡->
            {{evals.acquisitions[j].name}}

            {% elif acquisitions[j].level == 'MaÃ®trise fragile'  %}ðŸŸ¡->
            {{evals.acquisitions[j].name}}

            {% elif acquisitions[j].level == 'MaÃ®trise insuffisante'  %}ðŸ”´->
            {{evals.acquisitions[j].name}}

            {% else %}?-> {{evals.acquisitions[j].name}}

            {% endif %}{% endfor %}   

            {% else %}

            {% if acquisitions[0].level == 'TrÃ¨s bonne maÃ®trise' %}ðŸ”µ->
            {{evals.acquisitions[0].name}}

            {% elif acquisitions[0].level == 'MaÃ®trise satisfaisante' %}ðŸŸ¢->
            {{evals.acquisitions[0].name}}

            {% elif acquisitions[0].level == "DÃ©but de maÃ®trise" %}ðŸŸ¡->
            {{evals.acquisitions[0].name}}

            {% elif acquisitions[0].level == 'MaÃ®trise fragile'  %}ðŸŸ¡->
            {{evals.acquisitions[0].name}}

            {% elif acquisitions[0].level == 'MaÃ®trise insuffisante'  %}ðŸ”´->
            {{evals.acquisitions[0].name}}

            {% else %}?-> {{evals.acquisitions[0].name}}

            {% endif %}{% endif %}
mode: single
